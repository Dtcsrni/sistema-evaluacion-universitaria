%%{init: {"theme":"base","fontFamily":"Segoe UI, Arial, sans-serif","fontSize":22,"themeVariables":{"fontFamily":"Segoe UI, Arial, sans-serif","fontSize":22,"primaryColor":"#e8f1ff","primaryBorderColor":"#3b82f6","primaryTextColor":"#0b1f3a","secondaryColor":"#f0f9ff","tertiaryColor":"#f8fafc","lineColor":"#334155","textColor":"#0f172a","noteBkgColor":"#fff7cc","noteTextColor":"#713f12","noteBorderColor":"#eab308","actorBkg":"#1e3a8a","actorBorder":"#1e40af","actorTextColor":"#ffffff","labelBoxBkgColor":"#e8f1ff","labelBoxBorderColor":"#3b82f6","labelTextColor":"#0b1f3a"},"flowchart":{"curve":"linear","nodeSpacing":110,"rankSpacing":150},"sequence":{"actorMargin":70,"messageMargin":45}}}%%
%% AUTO:START system_model
%% Generado por scripts/diagramas.mjs (no editar este bloque)
%% Backend:
%% - prefijo: /api
%% - montajes publicos: /autenticacion, /salud
%% - montajes protegidos: /admin, /alumnos, /analiticas, /banco-preguntas, /calificaciones, /entregas, /examenes, /omr, /papelera, /periodos, /sincronizaciones
%% Portal alumno cloud:
%% - prefijo: /api/portal
%% - GET: /examen/:folio, /resultados, /resultados/:folio, /salud
%% - POST: /eventos-uso, /ingresar, /limpiar, /sincronizacion-docente/pull, /sincronizacion-docente/push, /sincronizar
%% AUTO:END system_model
sequenceDiagram
  actor Docente
  participant Web as Web Docente Local #e8f1ff
  participant API as API Docente Local #e8f1ff
  participant DB as MongoDB Local docentes #dbeafe
  participant FS as Repositorio PDFs locales #fef3c7
  participant Portal as API Portal Alumno Cloud #e8f1ff
  participant CloudDB as MongoDB Cloud resultados #dbeafe
  %% LEYENDA_COLOR
  Note over Docente,CloudDB: Leyenda de color<br/>Azul oscuro: Usuario<br/>Azul claro: Servicio<br/>Azul medio: Base de datos<br/>Amarillo: Repositorio<br/>Gris: Externo

  Docente->>Web: Publicar resultados
  Web->>API: POST /api/sincronizaciones/publicar
  API->>DB: Armar payload: periodo, alumnos, calificaciones, examenes, banderas, codigoAcceso
  API->>FS: Leer PDFs locales opcional
  API->>API: Comprimir PDF (gzip + base64)
  API->>Portal: POST /api/portal/sincronizar (API Key)
  Portal->>CloudDB: Upsert resultados + codigo de acceso
  Portal-->>API: OK
  API->>DB: Guardar sincronizacion
  API-->>Web: OK
