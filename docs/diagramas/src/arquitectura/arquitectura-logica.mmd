%%{init: {"theme":"base","fontFamily":"Segoe UI, Arial, sans-serif","fontSize":22,"themeVariables":{"fontFamily":"Segoe UI, Arial, sans-serif","fontSize":22,"primaryColor":"#e8f1ff","primaryBorderColor":"#3b82f6","primaryTextColor":"#0b1f3a","secondaryColor":"#f0f9ff","tertiaryColor":"#f8fafc","lineColor":"#334155","textColor":"#0f172a","noteBkgColor":"#fff7cc","noteTextColor":"#713f12","noteBorderColor":"#eab308","actorBkg":"#1e3a8a","actorBorder":"#1e40af","actorTextColor":"#ffffff","labelBoxBkgColor":"#e8f1ff","labelBoxBorderColor":"#3b82f6","labelTextColor":"#0b1f3a"},"flowchart":{"curve":"linear","nodeSpacing":110,"rankSpacing":150},"sequence":{"actorMargin":70,"messageMargin":45}}}%%
%% AUTO:START system_model
%% Generado por scripts/diagramas.mjs (no editar este bloque)
%% Backend:
%% - prefijo: /api
%% - montajes publicos: /autenticacion, /salud
%% - montajes protegidos: /alumnos, /analiticas, /banco-preguntas, /calificaciones, /entregas, /examenes, /omr, /periodos, /sincronizaciones
%% Portal alumno cloud:
%% - prefijo: /api/portal
%% - GET: /examen/:folio, /resultados, /resultados/:folio, /salud
%% - POST: /eventos-uso, /ingresar, /limpiar, /sincronizar
%% AUTO:END system_model
flowchart LR
    classDef user fill:#1e3a8a,stroke:#1e40af,color:#ffffff;
    classDef svc fill:#e8f1ff,stroke:#3b82f6,color:#0b1f3a;
    classDef db fill:#dbeafe,stroke:#1d4ed8,color:#0b1f3a;
    classDef repo fill:#fef3c7,stroke:#f59e0b,color:#7c2d12;
    classDef ext fill:#f1f5f9,stroke:#94a3b8,color:#0f172a;

  subgraph Local["Entorno local (Docente)"]
    userDoc[Docente]:::user
    webDoc[Web Docente Local<br/>React app_docente]:::svc
    apiDoc[API Docente Local<br/>Express + TS<br/>apps backend]:::svc
    mongo[(MongoDB Local<br/>docentes y examenes)]:::db
    pdfStore[[Repositorio PDFs locales<br/>data/examenes]]:::repo
    omr[Servicio OMR + PDF + QR<br/>sharp + pdf-lib + qrcode]:::svc
  end

  subgraph Cloud["Nube (Portal Alumno)"]
    userAlu[Alumno]:::user
    webAlu[Web Alumno Portal<br/>React app_alumno]:::svc
    apiPortal[API Portal Alumno Cloud<br/>Express + TS<br/>portal_alumno_cloud]:::svc
    mongoCloud[(MongoDB Cloud<br/>resultados y sesiones)]:::db
  end

  userDoc --> webDoc
  webDoc -->|HTTP JSON| apiDoc
  apiDoc -->|CRUD| mongo
  apiDoc -->|genera PDF + QR| pdfStore
  apiDoc -->|procesa imagenes OMR| omr

  apiDoc -->|publica calificaciones + PDF<br/>API Key| apiPortal
  apiPortal -->|persistencia| mongoCloud

  userAlu --> webAlu
  webAlu -->|HTTP JSON| apiPortal

  extMail[Servicio Correo SMTP<br/>opcional]:::ext
  apiDoc -.->|envia codigo acceso| extMail

%% LEYENDA_COLOR
  subgraph Leyenda["Leyenda de color"]
    direction TB
    lgUser[Usuario]:::user
    lgSvc[Servicio]:::svc
    lgDb[(Base de datos)]:::db
    lgRepo[[Repositorio]]:::repo
    lgExt[Externo]:::ext
  end
  style Leyenda fill:#f8fafc,stroke:#e2e8f0,stroke-width:1px,rx:6,ry:6
